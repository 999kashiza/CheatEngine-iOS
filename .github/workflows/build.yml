name: Build dylib Direct

on: workflow_dispatch

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Build dylib with Xcode
      run: |
        # Compilation directe pour iOS
        SDK_PATH=$(xcrun --sdk iphoneos --show-sdk-path)
        
        clang -arch arm64 -arch arm64e \
          -isysroot $SDK_PATH \
          -framework Foundation \
          -framework UIKit \
          -dynamiclib \
          -o cemobile.dylib \
          Tweak.xm \
          -fobjc-arc
        
        # Signature fake pour iOS
        brew install ldid
        ldid -S cemobile.dylib
        
        # VÃ©rification
        file cemobile.dylib
    
    - name: Upload
      uses: actions/upload-artifact@v4
      with:
        name: cemobile-dylib
        path: |
          cemobile.dylib
          cemobile.plist
